<res src="table_menu.less" type="css" />
<res src="/common/jquery-3.4.1.min.js" type="js" />

<div id="table_context_menu" class="table-display_context_menu table-menu-role_{!employee_role}">
	<ul class="table-menu_list">
		<li onclick="showOrder()" class="table-menu-option_order">
			<i></i> Order
		</li>
		
		<li onclick="printCheck()" class="table-menu-option_print_check">
			<i></i> Print Check
		</li>
		
		<li onclick="clearTable()" class="table-menu-option_clear">
			<i></i> Clear Table
		</li>
		
		<span>
			&nbsp;&nbsp;&nbsp;------- TEMP -------
		</span>
		
		<li onclick="updateStatus('Open')"> Set Open </li>
		<li onclick="updateStatus('Seated')"> Set Seated </li>
		<li onclick="updateStatus('Order_Placed')"> Set Ordered </li>
		<li onclick="updateStatus('Check_Printed')"> Set Check-Printed </li>
	</ul>
</div>

<script>
	var TableDisplay = TableDisplay || {};
	TableDisplay.menuActionCallback = function(data) {
		Object.assign(TableDisplay.menu_item.table, data.table);
		TableDisplay.menu_item.updateElement();
		TableDisplay.closeMenu();
	};

	function updateStatus(status) {
		if(!TableDisplay.menu_item) return;
		
		Request.ajax({
			url: "/api/table/status",
			method: "POST",
			
			data: {
				"id": TableDisplay.menu_item.table.id,
				"status": status
			},
			
			done: TableDisplay.menuActionCallback
		});
	}
	
	function printCheck() {
		if(!TableDisplay.menu_item) return;
		
		PrintCheck && PrintCheck.printCheck(TableDisplay.menu_item.table.id);
		Popup.show("print-check");
	}
	
	function clearTable() {
		if(!TableDisplay.menu_item) return;
		
		Request.ajax({
			url: "/api/table/clear",
			method: "POST",
			
			data: {
				"id": TableDisplay.menu_item.table.id,
			},
			
			done: TableDisplay.menuActionCallback
		});
	}
	
	function showOrder() {
		if(!TableDisplay.menu_item) return;
		
		Order && Order.newOrder(TableDisplay.menu_item.table.id);
		Popup.show("edit-order");
		
		/*if(TableDisplay.menu_item.table.status == "Open") {
			Order && Order.newOrder(TableDisplay.menu_item.table.id);
			Popup.show("edit-order");
		} else {
			Order && Order.openOrder(TableDisplay.menu_item.table.id);
			Popup.show("edit-order");
		}*/
	}
	
	$("#table_context_menu li").on("click", e => e.stopPropagation());
</script>